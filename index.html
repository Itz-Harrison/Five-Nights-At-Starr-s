<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
    <style>
        body { 
            background-color: black; 
            color: #FFFB00; 
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 10px;
            overflow: hidden;
        }
        h1 { color: #FFFB00; text-shadow: 0px 0px 10px #FFFB00; margin: 5px; font-size: 24px; }
        #game-output {
            background-color: #000;
            color: #FFFB00;
            padding: 15px;
            width: 95%;
            max-width: 600px;
            white-space: pre-wrap;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #FFFB00;
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            box-shadow: inset 0 0 15px #222;
        }
        #input-area {
            display: flex;
            width: 95%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        #user-input {
            flex-grow: 1;
            background: #111;
            color: #FFFB00;
            border: 2px solid #FFFB00;
            padding: 12px;
            font-size: 18px;
            font-family: monospace;
            outline: none;
        }
        #send-btn {
            background: #FFFB00;
            color: black;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body onload="brython()">
    <h1>Five Nights At Starr's</h1>
    <div id="game-output">SYSTEM INITIALIZING...</div>
    
    <div id="input-area">
        <input type="text" id="user-input" placeholder="Enter move..." autocomplete="off">
        <button id="send-btn">SEND</button>
    </div>

    <script type="text/python">
from browser import document, window, timer
import sys
import random

# --- WEB ENGINE SETUP ---
def write(data):
    document["game-output"].text += str(data)
    document["game-output"].scrollTop = document["game-output"].scrollHeight
sys.stdout.write = write

# --- FULL GAME DATA & SAVE SYSTEM ---
stats = {
    "tix": 0, "night": 1, "alarm": False, "custom_unlocked": False,
    "sys_shutdown": False, "extra_power": False, "vent_stopper": False, "triple_tix": False
}

state = "MENU"
night_data = {}

def save_game():
    window.localStorage["starrs_save"] = str(stats)

def load_game():
    save = window.localStorage.getItem("starrs_save")
    if save:
        try: stats.update(eval(save))
        except: pass

def show_menu():
    global state
    state = "MENU"
    document["game-output"].text = ""
    print("      ðŸ’› ðŸ’› ðŸ’›\n   5 NIGHTS AT STARR'S")
    print(f"Tickets: {stats['tix']} | Night: {stats['night']}")
    print("-" * 30)
    print("1) START NIGHT\n2) PRIZE COUNTER\n3) LOADOUT")
    if stats["custom_unlocked"]: print("4) GOLDEN CUSTOM NIGHT")
    print("5) RESET PROGRESS")

def start_night(is_custom=False):
    global state, night_data
    state = "PLAYING"
    diff = 10 if is_custom else stats["night"] + 2
    night_data = {
        "is_custom": is_custom, "pwr": 150 if stats["extra_power"] else 100,
        "hr": 12, "corrupt": 0, "endo": 0, "baby_idx": 0, "baby_wait": 0,
        "l_door": False, "r_door": False, "scrap": False, "diff": diff,
        "baby_side": random.choice(["Left", "Right"])
    }
    document["game-output"].text = f"--- {'GOLDEN NIGHT' if is_custom else 'NIGHT ' + str(stats['night'])} ---\n"
    update_night_display()

def update_night_display():
    n = night_data
    print(f"\n[{n['hr']} AM] [PWR: {int(n['pwr'])}%] [LEVEL: {n['diff']}]")
    if n['scrap']: print(">> !!! WARNING: DOORS OFFLINE !!! <<")
    print("1:Cams 2:Listen 3:L-Door 4:R-Door 5:Vent 6:Reset")

def handle_input(ev):
    global state
    cmd = document["user-input"].value.strip().upper()
    document["user-input"].value = ""
    
    if state == "MENU":
        if cmd == "1": start_night()
        elif cmd == "2":
            state = "SHOP"
            print("\n- PRIZE COUNTER - (Cost: 150t)\n1)Alarm 2)Shutdown 3)Power 4)Stopper 5)3xTix(200t) 6)BACK")
        elif cmd == "3":
            print("\n--- LOADOUT ---")
            for k, v in stats.items():
                if v == True and k not in ["custom_unlocked"]: print(f"[X] {k}")
            print("\n(Type any key to go back)")
            state = "LOADOUT"
        elif cmd == "4" and stats["custom_unlocked"]: start_night(True)
        elif cmd == "5":
            stats.update({"tix":0,"night":1,"extra_power":False,"custom_unlocked":False})
            save_game(); show_menu()

    elif state == "SHOP":
        keys = {"1":"alarm","2":"sys_shutdown","3":"extra_power","4":"vent_stopper","5":"triple_tix"}
        if cmd in keys:
            cost = 200 if cmd == "5" else 150
            if stats["tix"] >= cost:
                stats[keys[cmd]] = True; stats["tix"] -= cost; save_game(); print("Purchased!")
        show_menu()

    elif state == "LOADOUT":
        show_menu()

    elif state == "PLAYING":
        n = night_data
        # Movement Logic
        n["pwr"] -= (1.5 + (2.0 if n["l_door"] else 0) + (2.0 if n["r_door"] else 0))
        
        if cmd == "1": print(f"Vent: {n['endo']}/5 | Corruption: {n['corrupt']}/5")
        elif cmd == "2": 
            loc = "OFFICE DOOR" if n['baby_idx'] >= 4 else "ARCADE"
            print(f"Audio: Movement detected in {loc}")
        elif cmd == "3" and not n["scrap"]: n["l_door"] = not n["l_door"]; print(f"L-Door: {'CLOSED' if n['l_door'] else 'OPEN'}")
        elif cmd == "4" and not n["scrap"]: n["r_door"] = not n["r_door"]; print(f"R-Door: {'CLOSED' if n['r_door'] else 'OPEN'}")
        elif cmd == "5":
            if n["endo"] >= 3: print("\n>> Vent Cleared! <<"); n["endo"] = 0
            else: game_over("Starr Endo")
        elif cmd == "6": n["corrupt"] = 0; n["scrap"] = False; print("Systems Reset.")

        # --- AI TURN ---
        if n["scrap"]: game_over("Scrap Starr")
        if random.randint(1, 15) < n["diff"]: n["corrupt"] += 1
        if n["corrupt"] >= 5: n["scrap"] = True; n["l_door"] = n["r_door"] = False

        if not stats["vent_stopper"] and random.randint(1, 15) < n["diff"]: n["endo"] += 1
        
        if n["baby_idx"] < 4:
            if random.randint(1, 10) < n["diff"]: n["baby_idx"] += 1
        else:
            door = n["l_door"] if n["baby_side"] == "Left" else n["r_door"]
            if door:
                print("\n>> Thud... Something retreated. <<")
                n["baby_idx"] = 0; n["baby_side"] = random.choice(["Left", "Right"])
            else:
                n["baby_wait"] += 1
                if n["baby_wait"] >= 2: game_over("Golden Starr" if n["is_custom"] else "Starr Baby")

        # Check Power & Time
        if n["pwr"] <= 0: game_over("Starr Baby (Power Out)")
        elif n["endo"] >= 5: game_over("Starr Endo")
        else:
            n["hr"] = 1 if n["hr"] == 12 else n["hr"] + 1
            if n["hr"] == 6:
                print("\n6:00 AM! Night Complete!"); 
                stats["tix"] += 450 if stats["triple_tix"] else 150
                if not n["is_custom"]: stats["night"] += 1
                if stats["night"] >= 6: stats["custom_unlocked"] = True
                save_game(); show_menu()
            else: update_night_display()

def game_over(who):
    print(f"\n!!! JUMPSCARE: {who.upper()} !!!\nGAME OVER")
    timer.set_timeout(show_menu, 3000)

document["send-btn"].bind("click", handle_input)
document["user-input"].bind("keydown", lambda e: handle_input(e) if e.keyCode == 13 else None)

load_game()
show_menu()
    </script>
</body>
</html>
