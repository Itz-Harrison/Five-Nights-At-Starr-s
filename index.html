<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Five Nights At Starr's</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.12.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.12.0/brython_stdlib.js"></script>
    <style>
        body { 
            background-color: black; 
            color: #FFFB00; 
            font-family: 'Courier New', Courier, monospace; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            padding: 10px; 
            overflow: hidden; 
        }
        h1 { 
            color: #FFFB00; 
            text-shadow: 0px 0px 10px #FFFB00; 
            margin: 5px; 
            font-size: 24px; 
            text-align: center; 
            letter-spacing: 2px; 
        }
        #input-area { 
            display: flex; 
            width: 95%; 
            max-width: 600px; 
            margin-bottom: 10px; 
            z-index: 100; 
        }
        #user-input { 
            flex-grow: 1; 
            background: #111; 
            color: #FFFB00; 
            border: 2px solid #FFFB00; 
            padding: 12px; 
            font-size: 18px; 
            outline: none; 
            border-radius: 0; 
        }
        #send-btn { 
            background: #FFFB00; 
            color: black; 
            border: none; 
            padding: 10px 15px; 
            font-weight: bold; 
            cursor: pointer; 
        }
        #game-output { 
            background-color: #000; 
            color: #FFFB00; 
            padding: 15px; 
            width: 95%; 
            max-width: 600px; 
            white-space: pre-wrap; 
            font-size: 16px; 
            font-weight: bold; 
            border: 2px solid #FFFB00; 
            flex-grow: 1; 
            overflow-y: auto; 
            box-shadow: inset 0 0 15px #FFFB0033; 
            transition: all 0.1s; 
        }
        
        /* SPECIAL EFFECTS */
        .corrupt-flicker { 
            color: #00FF00 !important; 
            text-shadow: 0px 0px 10px #00FF00; 
        }
        .perm-corrupt { 
            color: #00FF00 !important; 
            border-color: #00FF00 !important; 
            box-shadow: inset 0 0 20px #00FF0077 !important; 
        }
        .vent-warning { 
            color: #FF0000 !important; 
            text-shadow: 0px 0px 8px #FF0000; 
            font-weight: 900; 
        }

        .beating-heart { 
            font-size: 45px; 
            color: #FFFB00; 
            display: block; 
            margin: 20px auto; 
            animation: beat 0.8s infinite; 
            text-align: center; 
        }
        .victory-flash { 
            animation: flash 0.4s infinite; 
            font-size: 50px; 
            text-align: center; 
            margin-top: 40px; 
            font-weight: bold; 
        }
        @keyframes flash { 0%, 100% { color: #FFFB00; opacity: 1; } 50% { color: #FFF; opacity: 0.5; } }
        @keyframes beat { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    </style>
</head>
<body onload="brython()">
    <h1>FIVE NIGHTS AT STARR'S</h1>
    <div id="input-area">
        <input type="text" id="user-input" placeholder="Enter move..." autocomplete="off" autofocus>
        <button id="send-btn">SEND</button>
    </div>
    <div id="game-output">
        <div style="text-align:center; padding: 20px;">
            <div class="beating-heart">ðŸ’›</div>
            <p>INITIALIZING STARR OS...</p>
        </div>
    </div>

    <script type="text/python">
from browser import document, window, timer, html
import random
import json

# --- INITIAL GAME DATA ---
stats = {
    "tix": 0, 
    "night": 1, 
    "custom_unlocked": False, 
    "extra_power": False, 
    "vent_stopper": False, 
    "vent_alarm": False, 
    "sys_shutdown": False, 
    "triple_tix": False, 
    "beat_boss": False
}
n_data = {}
state = "MENU"

def save_game():
    window.localStorage["starrs_save"] = json.dumps(stats)

if "starrs_save" in window.localStorage:
    try:
        stats.update(json.loads(window.localStorage["starrs_save"]))
    except:
        pass

# --- AUDIO AND SFX ---
def play_sound(f_start, f_end, dur, wav="sawtooth", vol=0.2):
    try:
        ctx = window.AudioContext.new()
        osc = ctx.createOscillator()
        gain = ctx.createGain()
        osc.type = wav
        osc.frequency.setValueAtTime(f_start, ctx.currentTime)
        osc.frequency.exponentialRampToValueAtTime(f_end, ctx.currentTime + dur)
        gain.gain.setValueAtTime(vol, ctx.currentTime)
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + dur)
        osc.connect(gain)
        gain.connect(ctx.destination)
        osc.start()
        osc.stop(ctx.currentTime + dur)
    except:
        pass

def play_screech():
    play_sound(2200, 100, 0.6, "sawtooth", 0.5)
    play_sound(1600, 40, 0.6, "square", 0.4)

def play_golden_screech():
    play_sound(120, 10, 1.8, "sawtooth", 0.7)
    play_sound(80, 5, 1.8, "square", 0.6)

def play_retreat():
    play_sound(300, 100, 0.5, "sine", 0.2) 

def play_bang():
    for i in [0, 0.15]:
        play_sound(70, 60, 0.1, "square", 0.4)

def play_unlock():
    play_sound(600, 100, 0.3, "sawtooth", 0.5)

def trigger_green_flicker():
    out = document["game-output"]
    out.classList.add("corrupt-flicker")
    timer.set_timeout(lambda: out.classList.remove("corrupt-flicker"), 150)

# --- MENU AND SHOP SYSTEMS ---
def show_menu():
    global state
    state = "MENU"
    save_game()
    out = document["game-output"]
    out.classList.remove("perm-corrupt")
    out.html = '<div style="text-align:center;"><div class="beating-heart">ðŸ’›</div></div>'
    
    header = f"\nTickets: {stats['tix']} | Progress: Night {stats['night']}\n"
    if stats['beat_boss']:
        header += "â­ STATUS: GOLDEN CHAMPION â­\n"
    
    display = header + ">> DATA SAVED <<\n" + "-"*35 + "\n"
    display += "1) START NIGHT\n2) PRIZE COUNTER\n3) LOADOUT\n4) RESET DATA"
    
    if stats["night"] >= 6:
        display += "\n5) THE BOSS FIGHT (NIGHT 6)"
    if stats["custom_unlocked"]:
        display += "\n6) CUSTOM NIGHT"
    
    out.text += display

# --- CORE GAMEPLAY LOGIC ---
def start_night(mode="REGULAR", d_val=0):
    global state, n_data
    state = "PLAYING"
    is_b = (mode == "BOSS")
    
    n_data = {
        "pwr": 150 if stats["extra_power"] else 100,
        "hr": 12,
        "turn": 0,
        "corrupt": 0,
        "endo": 0,
        "endo_wait": 0,
        "baby_idx": 0,
        "l_door": False,
        "r_door": False,
        "scrap": False,
        "diff": d_val if mode=="CUSTOM" else (20 if is_b else stats["night"] + 2),
        "side": random.choice(["Left", "Right"]),
        "is_boss": is_b,
        "baby_wait": 0,
        "scrap_wait": 0,
        "path": ["Stage", "Main Arcade", "Play Area", "Hallway", "Office Door"],
        "last_msg": "System Online. Night Shift Started."
    }
    update_night()

def update_night():
    n = n_data
    out = document["game-output"]
    
    if n["corrupt"] >= 5:
        out.classList.add("perm-corrupt")
    else:
        out.classList.remove("perm-corrupt")
    
    out.html = ""
    top = f"[{n['hr']} AM] [PWR: {int(n['pwr'])}%]\n" + "-"*25 + f"\n> {n['last_msg']}\n" + "-"*25 + "\n"
    out <= top

    if stats["vent_alarm"] and n["endo"] >= 4:
        alarm_text = html.SPAN(">> [!] VENT ALARM BEEPING [!] <<\n", ClassName="vent-warning")
        out <= alarm_text
        play_sound(880, 880, 0.1, "sine", 0.1)
    
    status = []
    if n["l_door"]: status.append("L-DOOR CLOSED")
    if n["r_door"]: status.append("R-DOOR CLOSED")
    
    if status:
        out <= "STATUS: " + " & ".join(status) + "\n"
    
    out <= "\n0:Wait 1:Cams 2:Listen 3:L-Door 4:R-Door 5:Vent 6:Reset"

def win_screen():
    document["game-output"].html = '<div class="victory-flash">6:00 AM</div>'
    play_sound(440, 880, 1.2, "sine", 0.2)
    def finalize():
        if n_data["is_boss"]:
            stats["beat_boss"] = True
            stats["custom_unlocked"] = True
        else:
            stats["night"] += 1
            stats["tix"] += 450 if stats["triple_tix"] else 150
        show_menu()
    timer.set_timeout(finalize, 4000)

def handle_input(ev):
    global state
    cmd = document["user-input"].value.strip().upper()
    document["user-input"].value = ""
    
    if state == "MENU":
        if cmd == "1": start_night()
        elif cmd == "2":
            state = "SHOP"
            document["game-output"].text = f"\nTickets: {stats['tix']}\n1)Power Upgrade 2)Vent Lock 3)Alarm 4)Reset 5)Triple Tix 6)BACK"
        elif cmd == "3":
            state = "LOADOUT"
            document["game-output"].text = f"\n- LOADOUT -\nExtra Power: {stats['extra_power']}\nVent Stopper: {stats['vent_stopper']}\n\nType 0 to go back."
        elif cmd == "4": 
            if window.confirm("Erase all data?"):
                stats.update({"tix":0,"night":1,"custom_unlocked":False,"beat_boss":False})
                save_game(); show_menu()
        elif cmd == "5" and stats["night"] >= 6: start_night("BOSS")

    elif state == "PLAYING":
        n = n_data
        n["pwr"] -= (0.5 if cmd == "0" else 1.3) + (2.2 if (n["l_door"] or n["r_door"]) else 0)
        n["turn"] += 1
        
        if n["turn"] >= 8: 
            n["turn"] = 0
            n["hr"] = 1 if n["hr"] == 12 else n["hr"] + 1

        if cmd == "1":
            n["last_msg"] = f"CAMS: Vent {n['endo']}/5. System Corruption: {n['corrupt']}."
        elif cmd == "2":
            if n["baby_idx"] == 4: n["last_msg"] = f"LISTEN: Heavy breathing at {n['side']} DOOR!"
            elif n["baby_idx"] >= 2: n["last_msg"] = f"LISTEN: Footsteps in {n['path'][n['baby_idx']]}."
            else: n["last_msg"] = "LISTEN: Silence..."
        elif cmd == "3":
            n["l_door"] = not n["l_door"]
            n["r_door"] = False
        elif cmd == "4":
            n["r_door"] = not n["r_door"]
            n["l_door"] = False
        elif cmd == "5":
            if n["endo"] >= 3:
                n["endo"] = 0
                n["last_msg"] = "VENT: Air flushed."
            else:
                play_screech(); show_menu(); return
        elif cmd == "6":
            if n["corrupt"] >= 3:
                n["corrupt"] = 0
                n["scrap"] = False
                n["last_msg"] = "SYSTEM: Reboot complete."
            else:
                play_screech(); show_menu(); return

        # AI ENEMY UPDATES
        if n["scrap"]:
            n["scrap_wait"] += 1
            if n["scrap_wait"] == 1:
                n["l_door"] = n["r_door"] = False
                play_unlock()
                n["last_msg"] = "!! SYSTEM MALWARE: DOORS UNLOCKED !!"
            if n["scrap_wait"] >= 2:
                play_screech(); show_menu(); return
        elif random.randint(1, 15) < n["diff"]:
            n["corrupt"] += 1
            if n["corrupt"] >= 5: n["scrap"] = True
            else: trigger_green_flicker()

        if n["baby_idx"] == 4:
            dr = n["l_door"] if n["side"] == "Left" else n["r_door"]
            if not dr:
                n["baby_wait"] += 1
                if n["baby_wait"] >= 2:
                    play_screech(); show_menu(); return
            else:
                n["baby_wait"] += 1
                play_bang()
                if n["baby_wait"] >= 4:
                    n["baby_idx"] = 0
                    n["baby_wait"] = 0
                    n["side"] = random.choice(["Left", "Right"])
                    play_retreat()
        elif random.randint(1, 10) < n["diff"]:
            n["baby_idx"] += 1

        if n["hr"] == 6: win_screen()
        elif n["pwr"] <= 0: play_screech(); show_menu()
        else: update_night()

    elif cmd == "0" or cmd == "6": 
        show_menu()

document["send-btn"].bind("click", handle_input)
document["user-input"].bind("keydown", lambda e: handle_input(e) if e.keyCode == 13 else None)
timer.set_timeout(show_menu, 1000)
    </script>
</body>
</html>
